%include part: see main.beamer.tex and main.article.tex
%include common packages and settings
\input{./../common}
\input{./../newcommand}

\title[Ускоренное умножение]{Умножение в прямом коде\\(с ускорением второго и третьего порядков)}

\newcounter{TaskSimpleCtr}
\setcounter{TaskSimpleCtr}{1}
\newcommand{\TaskSimpleNumber}{ \arabic{TaskSimpleCtr}) \addtocounter{TaskSimpleCtr}{1} }

%вставка изображений из metapost (post script)
\DeclareGraphicsRule{*}{mps}{*}{}

\begin{document}

\mode<article>{\maketitle\tableofcontents}
\frame<presentation>{\titlepage}
\begin{frame}<presentation>
    \frametitle{Содержание}
    \tableofcontents
\end{frame}


\section{Ускорение второго порядка}


\subsection{Обоснование корректности}


\begin{frame}
    \frametitle{Двоично-кодированные четверичные числа}

    \begin{block}{}
        Два разряда двоичного числа $\equiv$ один четверичный разряд.
    \end{block}
    
    \begin{itemize}
        \item Разряды двоичного числа группируются по \emph{два} и сдвиги множителя (а также множимого или суммы частичных произведений) выполняются сразу на \emph{два} двоичных разряда. 
    
        \item Количество разрядов двоичной сетки выбирается кратным \emph{двум}.
    
        \item Такой подход теоретически сокращает количество шагов умножения \emph{вдвое}.
    \end{itemize}    
\end{frame}

\begin{frame}
    \frametitle{Правила умножения четверичной системы}

    \[X=(a_n\cdots a_0)_4=(b_m\cdots b_0)_2.\]
    
    \begin{block}{}
        Если на некотором шаге анализируется $i$-й четверичный разряд $a_i$, то в двоичном представлении анализируется пара  $(b_{2i+1},b_{2i})$ множителя $X$:
    \end{block}
    
    \[
        \begin{tabular}{c|cc|l}
            \hline\hline
            $a_i$ & $(b_{2i+1},$ & $b_{2i})$ & Действие над СЧП\\
            \hline\hline
            0     & 0           & 0         & $+0$, просто!\\
            1     & 0           & 1         & $+M$, прибавить множимое $M$, просто!\\
            2     & 1           & 0         & $+2M$, просто! $\Machine{shl($M$,1)}$ \\
            3     & 1           & 1         & $+3M$, \emph{долго?!} \\
            \hline
        \end{tabular}
    \]
\end{frame}

\begin{frame}
    \frametitle{$+3M$-проблема!}
    \framesubtitle{Четверичная система счисления с отрицательными цифрами}

    В четверичной системе счисления используются цифры $\{0,1,2,3\}$.
    
    \begin{block}{}
        \begin{center}
            Нас не устраивает цифра $3$
        \end{center}
    \end{block}
    
    Мы можем использовать 4CC с другим набором цифр: $\{-1,0,1,2\}$.
    \begin{block}{Обозначим для удобства}
        \[-1\equiv \bar{1}\]
    \end{block}
    \[
        \begin{tabular}{c|l}
            \hline\hline
            $a_i$       & Действие над СЧП\\
            \hline\hline
            $0$         & $+0$,  просто!\\
            $1$         & $+M$,  просто!\\
            $2$         & $+2M$, просто!\\
            $\bar{1}$   & $-M$,  просто!\\
            \hline
        \end{tabular}
    \]
\end{frame}

\begin{frame}
    \frametitle{Представим \emph{множитель}}
    \framesubtitle{в четверичной системе счисления с отрицательными цифрами}
    
    \[
        3=4-1=(10)_4-1=
            \underbrace{(10)_4}_\text{\tiny{перенос}} + (\bar{1})_4
    \]
    
    \begin{block}{Чтобы выполнить перевод из 4СС достаточно}
        цифру $3$ (пусть она встретилась в $i$-м разряде) заменить на цифру $\bar{1}$, и распространить перенос из $i$-го разряда далее по числу.
    \end{block}
\end{frame}

\begin{frame}
    \frametitle{Представим \emph{множитель} $(3213023)_4$}
    \framesubtitle{в четверичной системе счисления с отрицательными цифрами $\{\bar{1},0,1,2\}$}
    
    \begin{block}{Начав с младших разрядов, не встречаем трудностей:}
        \[
            \begin{tabular}{r|cccccccc}
                Перенос:            &\uncover<8->{1}
                                        &\uncover<7->{0}
                                            &\uncover<6->{0}
                                                &\uncover<5->{1}
                                                    &\uncover<4->{0}
                                                        &\uncover<3->{1}
                                                            &\uncover<2->{1}
                                                                &\uncover<2->{0}\\
                Исходное число:     &\uncover<8->{0}
                                        &\uncover<1->{3}
                                            &\uncover<1->{2}
                                                &\uncover<1->{1}
                                                    &\uncover<1->{3}
                                                        &\uncover<1->{0}
                                                            &\uncover<1->{2}
                                                                &\uncover<1->{3}\\
                Сумма с переносом:  &\uncover<9->{1}
                                        &\uncover<8->{3}
                                            &\uncover<7->{2}
                                                &\uncover<6->{2}
                                                    &\uncover<5->{3}
                                                        &\uncover<4->{1}
                                                            &\uncover<3->{3}
                                                                &\uncover<2->{3}\\ \hline
                                    &   &   &   &   &   &   &   &\\
                Результат:          &\uncover<9->{1}
                                        &\uncover<8->{$\bar{1}$}
                                            &\uncover<7->{2}
                                                &\uncover<6->{2}
                                                    &\uncover<5->{$\bar{1}$}
                                                        &\uncover<4->{1}
                                                            &\uncover<3->{$\bar{1}$}
                                                                &\uncover<2->{$\bar{1}$}\\
            \end{tabular}
        \]
    \end{block}
    
    \uncover<10->{
        Проверка:
        \begin{align*}
            (3213023)_4=
                &3\cdot 4^6 + 2\cdot 4^5 + 4^4 + 3\cdot 4^3 + 0 + 2\cdot 4 + 3
                    &=14795\\
            (1\bar{1}22\bar{1}1\bar{1}\bar{1})_4=
                &4^7 - 4^6 + 2\cdot 4^5 + 2\cdot 4^4 - 4^3 + 4^2 - 4 - 1 
                    &=14795
        \end{align*}
    }
\end{frame}

\begin{frame}
    \frametitle{Алгоритм перевода с младших разрядов}

    \begin{algorithmic}[1]
        \REQUIRE{$(a_{n}\cdots a_0)_4$ --- исходное число в 4СС, $(a_n + 1)<3$}
        \ENSURE{$(d_{n}\cdots d_0)_{\pm 4}$--- число в 4СС с отрицательными цифрами}
        
        \STATE{$p\gets 0$;}
        \FOR{$i=0$ to $n$}
            \IF{$(a_i + p)\ge 3$}
                \STATE{$d_i\gets (a_i - 4)$; $p\gets 1$;}
            \ELSE
                \STATE{$d_i\gets a_i$; $p\gets 0$;}
            \ENDIF
        \ENDFOR
        
        \RETURN{$(d_{n}\cdots d_0)_{\pm 4}$}
    \end{algorithmic}
\end{frame}

\begin{frame}
    \frametitle{Совмещение с умножением}
    
    Нельзя выполнять преобразование множителя заранее --- иначе получить выигрыш во времени не получится.
    
    \begin{block}{Перевод множителя из обычной 4СС в}
        4CC с отрицательными цифрами должен выполняться <<на лету>>, прямо в цикле умножения.
    \end{block}
    
    Рассмотренный перевод с младших разрядов легко совмещается с I и II способами умножения.
    
    \begin{block}{Но в III и IV способах требуется}
        <<на лету>> перевести множитель в 4CC с отрицательными цифрами, продвигаясь со \emph{старших} разрядов!
    \end{block}
\end{frame}

\begin{frame}
    \frametitle{Алгоритм перевода со старших разрядов}

    Так как переносы распространяются от младших разрядов к старшим, то
    
    \begin{block}{при переводе от старших разрядов к младшим требуется}
        правильно \emph{предсказать} перенос из предыдущего младшего разряда.
    \end{block}
    
    Допустим, анализируется четверичная цифра $a_i$.
    \begin{block}{Можно ли по значению $a_{i-1}$ определенно сказать}
        будет ли в $i$-й разряд перенос из предыдущего при переводе?
    \end{block}
    
    \[
        \begin{tabular}{c|l}
            \hline\hline
            $a_{i-1}$ & Перенос\\
            \hline\hline
            \Number{0} & нет\\
            \Number{1} & нет\\
            \Number{2} & ??? Если в $a_{i-1}$ будет перенос --- да, иначе --- нет\ldots\\
            \Number{3} & да\\
            \hline
        \end{tabular}
    \]
\end{frame}

\begin{frame}
    \frametitle{Проблема предсказания переноса при $a_{i-1} = 2$}
    
    Выход из положения --- 
    \begin{block}{выполнять замену}
        \[
            2 = 4 - 2 = \underbrace{(10)_4}_\text{\tiny{перенос}} + (\bar{2})_4.
        \]
        Тогда неопределенность устраняется: перенос из $a_{i-1} = 2$ будет всегда, а цифру 
        \[
             \bar{2}\equiv -2.
        \]
        легко получить <<на лету>>.
    \end{block}
    В этом случае будем иметь дело с 4СС с цифрами $\{\bar{2},\bar{1},0,1,2\}$\footnote{Цифр больше, чем надо, но цифра 2 будет получаться, когда в текущем разряде 1, и прогнозируется перенос. Страдает только однозначность представления числа, например, $8=(1\bar{2}0)_{4}=(20)_4$.}.
\end{frame}

\begin{frame}
    \frametitle{Представим \emph{множитель} $(3213023)_4$}
    \framesubtitle{в четверичной системе счисления с отрицательными цифрами $\{\bar{2},\bar{1},0,1,2\}$}
    
    Выполняя перевод со старших разрядов,
    \begin{block}{прогнозируем переносы из младщих разрядов:}
        \[
            \begin{tabular}{r|ccccccccc}
                Перенос:            &\uncover<2->{1}
                                        &\uncover<3->{1}
                                            &\uncover<4->{0}
                                                &\uncover<5->{1}
                                                    &\uncover<6->{0}
                                                        &\uncover<7->{1}
                                                            &\uncover<8->{1}
                                                                &\uncover<9->{0}
                                                                    &
                                                                        \\
                Исходное число:     &\uncover<1->{0}
                                        &\uncover<1->{3}
                                            &\uncover<1->{2}
                                                &\uncover<1->{1}
                                                    &\uncover<1->{3}
                                                        &\uncover<1->{0}
                                                            &\uncover<1->{2}
                                                                &\uncover<1->{3}
                                                                    &\uncover<9->{,0}
                                                                        \\
                Сумма с переносом:  &\uncover<2->{1}
                                        &\uncover<3->{0}
                                            &\uncover<4->{2}
                                                &\uncover<5->{2}
                                                    &\uncover<6->{3}
                                                        &\uncover<7->{1}
                                                            &\uncover<8->{3}
                                                                &\uncover<9->{3}
                                                                    &
                                                                        \\ \hline
                                    &   &   &   &   &   &   &   &   &\\
                Результат:          &\uncover<2->{1}
                                        &\uncover<3->{0}
                                            &\uncover<4->{$\bar{2}$}
                                                &\uncover<5->{2}
                                                    &\uncover<6->{$\bar{1}$}
                                                        &\uncover<7->{1}
                                                            &\uncover<8->{$\bar{1}$}
                                                                &\uncover<9->{$\bar{1}$}
                                                                    &
                                                                        \\
            \end{tabular}
        \]
    \end{block}
    
    \uncover<10->{
        Проверка:
        \begin{align*}
            (3213023)_4=
                &3\cdot 4^6 + 2\cdot 4^5 + 4^4 + 3\cdot 4^3 + 0 + 2\cdot 4 + 3
                    &=14795\\
            (10\bar{2}2\bar{1}1\bar{1}\bar{1})_4=
                &4^7 - 2\cdot 4^5 + 2\cdot 4^4 - 4^3 + 4^2 - 4 - 1 
                    &=14795
        \end{align*}
    }
\end{frame}

\begin{frame}
    \frametitle{Алгоритм перевода со старших разрядов}

    \begin{algorithmic}[1]
        \REQUIRE{$(a_{n}\cdots a_0)_4$ --- исходное число в 4СС, где $a_n<2,a_{-1}=0$}
        \ENSURE{$(d_{n}\cdots d_0)_{\pm 4}$--- число в 4СС с отрицательными цифрами}
        
        \FOR{$i=n$ to $0$}
            \STATE{$c\gets a_i$;}
            \IF{$a_{i}\ge 2$}
                \STATE{$c\gets c - 4$;}  \COMMENT{этот перенос \emph{был} учтён на предыдущем шаге}
            \ENDIF
            \IF{$a_{i-1}\ge 2$}
                \STATE{$c\gets c + 1$;}  \COMMENT{учтём перенос, который \emph{будет} на следующем}
            \ENDIF
            \STATE{$d_i\gets c$;}
        \ENDFOR
        
        \RETURN{$(d_{n}\cdots d_0)_{\pm 4}$}
    \end{algorithmic}
\end{frame}

\begin{frame}
    \frametitle{Универсальный подход}
    \framesubtitle{Перевод $i$-го разряда}

    \begin{block}{Правило преобразования $a_i\mapsto d_i$ со старших разрядов}
        можно использовать и для преобразования с младших.
    \end{block}
    
    \begin{algorithmic}[1]
        \REQUIRE{$a_{i},a_{i-1}$ --- две четверичных цифры исходного числа в 4СС}
        \ENSURE{$d_i$ --- цифра в 4СС с отрицательными цифрами}
    
        \STATE{$c\gets a_i$;}
        \IF{$a_{i}\ge 2$}
            \STATE{$c\gets c - 4$;}  \COMMENT{перенос из $i$-го разряда}
        \ENDIF
        \IF{$a_{i-1}\ge 2$}
            \STATE{$c\gets c + 1$;}  \COMMENT{перенос в $i$-й разряд}
        \ENDIF
        \STATE{$d_i\gets c$;}
    \end{algorithmic}
\end{frame}

\begin{frame}
    \frametitle{Универсальный подход}
    \framesubtitle{Правила преобразования и действий в цикле умножения}

    \[
        \begin{tabular}{cc|l}
            \hline\hline
            $a_i$ & $a_{i-1}$ & $d_i\cdot M$ --- прибавляется к СЧП\\
            \hline\hline
            0     & $\{0,1\}$ & 0\\
            0     & $\{2,3\}$ & $+M$\\
            1     & $\{0,1\}$ & $+M$\\
            1     & $\{2,3\}$ & $+2M$\\
            2     & $\{0,1\}$ & $-2M$\\
            2     & $\{2,3\}$ & $-M$\\
            3     & $\{0,1\}$ & $-M$\\
            3     & $\{2,3\}$ & 0\\
            \hline
        \end{tabular}
    \]
\end{frame}

\begin{frame}
    \frametitle{Универсальный подход в 2СС}
    \framesubtitle{Правила преобразования и действий в цикле умножения}

    \[X=(a_n\cdots a_0)_4=(b_m\cdots b_0)_2.\]
    
    \begin{block}{Тек как в двоичном представлении}
        четверичные цифры $\{0,1\}$ в старшем разряде содержат 0, а $\{2,3\}$ содержат 1, то для составления таблицы действий в двоичной системе счисления, достаточно анализа трех двоичных разрядов:
        \[b_{2i+1},b_{2i},b_{2i-1},\]
        где $a_i\equiv(b_{2i+1},b_{2i})$ и $a_{i-1}\equiv(b_{2i-1},b_{2i-2})$.
    \end{block}
\end{frame}

\begin{frame}
    \frametitle{Универсальный подход в 2СС}
    \framesubtitle{Таблица действий в цикле умножения}

    \[
        \begin{tabular}{cccc|l}
            \hline\hline
            \multicolumn{2}{c}{$a_i$} 
                    & \multicolumn{2}{c|}{$a_{i-1}$}
                            & $d_i\cdot M$ --- прибавляется к СЧП\\
            $(b_{2i+1},$ 
                & $b_{2i})$ 
                    & $(b_{2i-1},$ 
                        & 
                            &\\
            \hline\hline
              0 & 0 & 0 &   & 0\\
              0 & 0 & 1 &   & $+M$\\
              0 & 1 & 0 &   & $+M$\\
              0 & 1 & 1 &   & $+2M$\\
              1 & 0 & 0 &   & $-2M$\\
              1 & 0 & 1 &   & $-M$\\
              1 & 1 & 0 &   & $-M$\\
              1 & 1 & 1 &   & 0\\
            \hline
        \end{tabular}
    \]
\end{frame}

\begin{frame}
    \frametitle{Резюме}

    \begin{itemize}
        \item Разряды двоичного числа группируются по \emph{два} и сдвиги множителя (а также множимого или суммы частичных произведений) выполняются сразу на \emph{два} двоичных разряда. 
    
        \item Количество разрядов двоичной сетки выбирается кратным \emph{двум}.
    
        \item Перевод в 4СС с отрицательными цифрами совмещается с основным циклом умножения.
        
        \item В цикле умножения выполняется анализ \emph{трех} двоичных разрядов.
        
        \item Множитель, представленный в 4СС с отрицательными цифрами может занять на один четверичный разряд больше, например: $(30)_4\equiv(1\bar{1}0)_{\pm 4}$. Этого не происходит, если старшая значащая четверичная цифра меньше двух.
    \end{itemize}    
\end{frame}


\subsection{Примеры}

\begin{frame}
    \frametitle{Умножение I сп.}
    \framesubtitle{$(100110)_2\cdot(100001)_2=(10011100110)_2$, масштаб операндов $4^3=2^6$.}
     
    \begin{tabular}{c|r|l}
                                                                   \hline\hline
        мн-ль $\rightarrow$ & 
                                \multicolumn{1}{|c|}{СЧП $\rightarrow$}       
                                                        & прим. \\ \hline\hline
        \NumberLo{00,1001}{10|.} & \Addition{00,000000 000000}  
                                            {10,11111. ......}
                                            {10,111110 000000} & $-2M$; сдвиг(2);\\ \hline
        \NumberLo{..,0010}{01|1} & \Addition{11,101111 100000}  
                                            {01,00001. ......}
                                            {00,110001 100000} & $+2M$; сдвиг(2);\\ \hline
        \NumberLo{..,..00}{10|0} & \Addition{00,001100 011000}  
                                            {10,11111. ......}
                                            {11,001010 011000} & $-2M$; сдвиг(2);\\ \hline
        \NumberLo{..,....}{00|1} & \Addition{11,110010 100110}  
                                            {00,100001 ......}
                                            {00,010011 100110} & $+M$; Рез-т!\\ \hline
    \end{tabular}
\end{frame}

\begin{frame}
    \frametitle{Умножение I сп.}
    \framesubtitle{$(100110)_2\cdot(100001)_2=(10011100110)_2$}
     
    Следует обратить внимание на следующие детали приведенного выше примера:
    \begin{itemize}
        \item Так как старшая цифра множителя --- 2, то будет сгенерирован перенос, и число в 4СС с отрицательными цифрами станет на разряд длиннее.
        \item Этот разряд также нужно анализировать и учитывать его вклад.
        \item Поэтому в множителе добавлен нулевой разряд (до запятой), что объясняет почему в каждом такте к СЧП множимое прибавляется (в 4СС) не сдвинутым (т.к. вклад последнего разряда --- $2^0$).
        \item К СЧП добавлен один четверичный разряд, чтобы не терять перенос.
    \end{itemize}
\end{frame}

\begin{frame}
    \frametitle{Умножение II сп.}
    \framesubtitle{$(100111)_2\cdot(100001)_2=(10100000111)_2$, масштаб операндов $4^3=2^6$.}
    
    \resizebox{!}{.85\height}{
        \begin{tabular}{c|r|l}
            \hline\hline
            мн-ль $\rightarrow$ 
                & \multicolumn{1}{|c|}{мн-е $\leftarrow$; СЧП}       
                & прим. \\ 
            \hline\hline
            \NumberLo{00,1001}{11|0}  
                & \Stack{
                    \Register{мн-е}{,000000 100001}}{
                          \Addition{,000000 000000}
                                   {,111111 011111}
                                   {,111111 011111}}  
                & $-M$; сдвиг(2);\\ \hline
            \NumberLo{..,0010}{01|1}  
                & \Stack{
                    \Register{мн-е}{,000010 0001..}}{
                          \Addition{,111111 011111}
                                   {,000100 001...}
                                   {,000011 100111}}  
                & $+2M$; сдвиг(2);\\ \hline
            \NumberLo{..,..00}{10|0}  
                & \Stack{
                    \Register{мн-е}{,001000 01....}}{
                          \Addition{,000011 100111}
                                   {,101111 1.....}
                                   {,110011 000111}}  
                & $-2M$; сдвиг(2);\\ \hline
            \NumberLo{..,....}{00|1}  
                & \Stack{
                    \Register{мн-е}{,100001 ......}}{
                          \Addition{,110011 000111}
                                   {,100001 ......}
                                   {,010100 000111}}  
                & $+M$; Рез-т!\\ \hline
        \end{tabular}
    }
\end{frame}

\begin{frame}
    \frametitle{Умножение II сп.}
    \framesubtitle{$(100111)_2\cdot(100001)_2=(10100000111)_2$}
     
    Следует обратить внимание на следующие детали приведенного выше примера:
    \begin{itemize}
        \item К множителю добавлен нулевой разряд (обоснование см. выше).
        \item К СЧП нулевой четверичный разряд не добавляется --- он не оказывает влияния на СЧП.
    \end{itemize}
\end{frame}

\begin{frame}
    \frametitle{Умножение III сп.}
    \framesubtitle{$(100111)_2\cdot(100001)_2=(10100000111)_2$, масштаб операндов $4^3=2^6$.}
    
    \begin{tabular}{c|r|l}
        \hline\hline
        мн-ль $\leftarrow$ 
            & \multicolumn{1}{|c|}{СЧП $\leftarrow$}       
            & прим. \\ 
        \hline\hline
        \NumberHi{00,1}{00111} 
            & \Addition{,000000 000000}
                       {,...... 100001}
                       {,000000 100001} 
            & $+M$; сдвиг(2);\\ \hline
        \NumberHi{10,0}{111..} 
            & \Addition{,000010 0001..}
                       {,111110 11111.}
                       {,000001 000010} 
            & $-2M$; сдвиг(2);\\ \hline
        \NumberHi{01,1}{1....} 
            & \Addition{,000100 0010..}
                       {,.....1 00001.}
                       {,000101 001010} 
            & $+2M$; сдвиг(2);\\ \hline
        \NumberHi{11,.}{.....} 
            & \Addition{,010100 1010..}
                       {,111111 011111}
                       {,010100 000111} 
            & $-M$; Рез-т!\\ \hline
    \end{tabular}
\end{frame}

\begin{frame}
    \frametitle{Умножение III сп.}
    \framesubtitle{$(100111)_2\cdot(100001)_2=(10100000111)_2$}
     
    Следует обратить внимание на следующие детали приведенного выше примера:
    \begin{itemize}
        \item К множителю добавлен нулевой разряд.
        \item В СЧП нулевой четверичный разряд не добавляется.
    \end{itemize}
\end{frame}

\begin{frame}
    \frametitle{Умножение IV сп.}
    \framesubtitle{$(100111)_2\cdot(100001)_2=(10100000111)_2$, масштаб операндов $4^3=2^6$.}
    
    \resizebox{!}{.85\height}{
        \begin{tabular}{c|r|l}
            \hline\hline
            мн-ль $\leftarrow$ 
                & \multicolumn{1}{|c|}{мн-е $\rightarrow$; СЧП}
                & прим. \\ 
            \hline\hline
            \NumberHi{00,1}{00111} 
                & \Stack{
                    \Register{мн-е}{,100001 ......}}{
                          \Addition{,000000 000000}
                                   {,100001 ......}
                                   {,100001 000000}}  
                & $+M$; сдвиг(2);\\ \hline
            \NumberHi{10,0}{111..} 
                & \Stack{
                    \Register{мн-е}{,..1000 01....}}{
                          \Addition{,100001 000000}
                                   {,101111 1.....}
                                   {,010000 100000}}  
                & $-2M$; сдвиг(2);\\ \hline
            \NumberHi{01,1}{1....} 
                & \Stack{
                    \Register{мн-е}{,....10 0001..}}{
                          \Addition{,010000 100000}
                                   {,...100 001...}
                                   {,010100 101000}}  
                & $+2M$; сдвиг(2);\\ \hline
            \NumberHi{11,.}{.....} 
                & \Stack{
                    \Register{мн-е}{,...... 100001}}{
                          \Addition{,010100 101000}
                                   {,111111 011111}
                                   {,010100 000111}}  
                & $-M$; Рез-т!\\ \hline
        \end{tabular}
    }
\end{frame}

\begin{frame}
    \frametitle{Умножение IV сп.}
    \framesubtitle{$(100111)_2\cdot(100001)_2=(10100000111)_2$}
     
    Следует обратить внимание на следующие детали приведенного выше примера:
    \begin{itemize}
        \item Множимое на первом шаге на четверичный разряд не сдвигается, так как к множителю добавлен нулевой разряд, который вносит вклад $M\cdot 4^0$.
        \item В СЧП нулевой четверичный разряд не добавляется.
    \end{itemize}
\end{frame}


\section{Ускорение третьего порядка}


\subsection{Обоснование корректности}


\begin{frame}
    \frametitle{Двоично-кодированные восмеричные числа}

    \begin{block}{}
        Три разряда двоичного числа $\equiv$ один восьмеричный разряд.
    \end{block}
    
    \[X=(a_n\cdots a_0)_8=(b_m\cdots b_0)_2.\]
    
    \begin{block}{}
        Если на некотором шаге анализируется $i$-й восьмеричный разряд $a_i$, то в двоичном представлении анализируется тройка $(b_{3i+2},b_{3i+1},b_{3i})$ множителя $X$:
    \end{block}
    
    \begin{itemize}
        \item Разряды двоичного числа группируются по \emph{три} и сдвиги множителя (а также множимого или суммы частичных произведений) выполняются сразу на \emph{три} двоичных разряда. 
    
        \item Количество разрядов двоичной сетки выбирается кратным \emph{трем}.
    
        \item Такой подход теоретически сокращает количество шагов умножения \emph{втрое}.
    \end{itemize}    
\end{frame}

\begin{frame}
    \frametitle{Правила умножения восьмеричной системы}

    \[
        \begin{tabular}{c|l}
            \hline\hline
            $a_i$ & К СЧП прибавляется\\
            \hline\hline
            0     & $0$,   просто!\\
            1     & $+M$,  просто!\\
            2     & $+2M$, просто! $\Machine{shl($M$,1)}$.\\
            3     & $+3M$, \emph{долго?!} \\
            4     & $+4M$, просто! $\Machine{shl($M$,2)}$.\\
            5     & $+5M$, \emph{долго?!} \\
            6     & $+6M$, \emph{долго?!} \\
            7     & $+7M$, \emph{долго?!} \\
            \hline
        \end{tabular}
    \]
\end{frame}

\begin{frame}
    \frametitle{Переход к отрицательным цифрам}
    
    \begin{block}{}
        Вычитанием из восьмерки степеней двойки\footnote{$\{1,2,4\}$ --- эти цифры нас устраивают: их можно получить сдвигом} можем получить цифры:
        \begin{itemize}
            \item $7=8-1$;
            \item $6=8-2$;
            \item $4=8-4$. Пока и без этого все хорошо!
        \end{itemize}
    \end{block}
    
    Остаются проблемные $3$ и $5$, которые выражаются друг через друга:
    \[
        5 = 8 - 3.
    \]
    
    Утроенное множимое придется вычислить \emph{заранее}!
\end{frame}

\begin{frame}
    \frametitle{Новые действия над суммой}
    
    \[
        \begin{tabular}{c|l}
            \hline\hline
            $a_i$ & К СЧП прибавляется\\
            \hline\hline
            0     & $0$,   просто!\\
            1     & $+M$,  просто!\\
            2     & $+2M$, просто! $\Machine{shl($M$,1)}$.\\
            3     & $+3M$, \emph{Вычислим заранее} \\
            4     & $+4M$, просто! $\Machine{shl($M$,2)}$.\\
            5     & $-3M$, просто: $5=8-3$, но учесть перенос в $a_{i+1}$. \\
            6     & $-2M$, просто: $6=8-2$, но учесть перенос в $a_{i+1}$. \\
            7     & $-M$, просто: $7=8-1$, но учесть перенос в $a_{i+1}$. \\
            \hline
        \end{tabular}
    \]
\end{frame}

\begin{frame}
    \frametitle{Навстречу переносу}
    
    В III и IV способах умножения выполняестя анализ старших разрядов.
    \begin{block}{Поэтому при анализе вклада $a_i$ нужно уметь предсказать}
        будет ли перенос из младшего восьмеричного разряда $a_{i-1}$?
    \end{block}
    \[
        \begin{tabular}{c|l}
            \hline\hline
            $a_{i-1}$ & Будет перенос в $a_i$?\\
            \hline\hline
            0     & нет.\\
            1     & нет.\\
            2     & нет.\\
            3     & нет.\\
            4     & ???\\
            5     & да.\\
            6     & да.\\
            7     & да.\\
            \hline
        \end{tabular}
    \]
\end{frame}

\begin{frame}
    \frametitle{Неоднозначнось возникновения переноса из $a_{i-1}=4$}

    \begin{block}{Если перенос в $a_{i-1}=4$}
        \begin{itemize}
            \item отсутствовал, то из $a_{i-1}$ переноса не будет: $4M=\Machine{shl($M$,2)}$;
            \item был, то $5$ преобразуется $5M=8M-3M$ и из $a_{i-1}$ будет перенос.
        \end{itemize}
    \end{block}

    Чтобы перенос из $a_{i-1}=4$ был всегда, при отсутствии переноса в этот разряд будем получать $4M$ как:
    \[
        4M=8M-4M=8M-\Machine{shl($M$,2)}.
    \]
    
    \begin{block}{}
        Из восьмеричного разряда $a_{i-1}$ будет перенос в $a_i$, если $a_{i-1}\ge 4$.
    \end{block}
    
    Восьмеричные цифры $\ge 4$, в двоичном представлении содержат единицу в старшем разряде: $(\Machine{1**})_2$.
    
    \begin{block}{}
        Следовательно, в двоичном представлении анализируется 4 разряда: три разряда $a_i$ и старший разряд $a_{i-1}$.
    \end{block}
\end{frame}

\begin{frame}
    \frametitle{Таблица действий в цикле умножения в 2СС}

    \resizebox{!}{.85\height}{
        \begin{tabular}{cccccc|l}
            \hline\hline
            \multicolumn{3}{c}{$a_i$} 
                    & \multicolumn{3}{c|}{$a_{i-1}$}
                            & $d_i\cdot M$\\
            $(b_{3i+2},$ 
                & $b_{3i+1},$ 
                    & $b_{3i})$ 
                        & $(b_{3i-1},$ 
                            & 
                                & 
                                    &прибавляется к СЧП\\
            \hline\hline
              0 & 0 & 0 & 0 &   &   & 0\\
              0 & 0 & 0 & 1 &   &   & $+M$\\ \hline
              0 & 0 & 1 & 0 &   &   & $+M$\\
              0 & 0 & 1 & 1 &   &   & $+2M$\\ \hline
              0 & 1 & 0 & 0 &   &   & $+2M$\\
              0 & 1 & 0 & 1 &   &   & $+3M$\\ \hline
              0 & 1 & 1 & 0 &   &   & $+3M$\\
              0 & 1 & 1 & 1 &   &   & $+4M$\\ \hline\hline
              1 & 0 & 0 & 0 &   &   & $-4M$\\
              1 & 0 & 0 & 1 &   &   & $-3M$\\ \hline
              1 & 0 & 1 & 0 &   &   & $-3M$\\
              1 & 0 & 1 & 1 &   &   & $-2M$\\ \hline
              1 & 1 & 0 & 0 &   &   & $-2M$\\
              1 & 1 & 0 & 1 &   &   & $-M$\\ \hline
              1 & 1 & 1 & 0 &   &   & $-M$\\
              1 & 1 & 1 & 1 &   &   & 0\\ \hline
            \hline
        \end{tabular}
    }
\end{frame}

\begin{frame}
    \frametitle{Резюме}

    \begin{itemize}
        \item Множитель представляется в 8СС системе счисления с цифрами $\{-4,-3,-2,-1,0,1,2,3,4\}$.
        
        \item Разряды двоичного числа группируются по \emph{три} и сдвиги множителя (а также множимого или суммы частичных произведений) выполняются сразу на \emph{три} двоичных разряда. 
    
        \item Количество разрядов двоичной сетки выбирается кратным \emph{трем}.
    
        \item Перевод в 8СС с отрицательными цифрами совмещается с основным циклом умножения.
        
        \item В цикле умножения выполняется анализ \emph{четырех} двоичных разрядов.
        
        \item Множитель, представленный в 8СС с отрицательными цифрами может занять на один восьмеричный разряд больше, например: $(40)_8\equiv(1\bar{4}0)_{\pm 4}$. Этого не происходит, если старшая значащая четверичная цифра меньше двух.
    \end{itemize}    
\end{frame}


\subsection{Примеры}


\begin{frame}
    \frametitle{Умножение I сп.}
    \framesubtitle{$(101011111)_2\cdot(111000001)_2=(100110011110011111)_2$, масштаб операндов $8^3=2^9$}
    
    $3\cdot(111000001)_2=(1110000010)_2+(111000001)_2=\Number{010,101000011}$
    \begin{tabular}{c|r|l}
                                                                   \hline\hline
        мн-ль $\rightarrow$ & 
                                \multicolumn{1}{|c|}{СЧП $\rightarrow$}       
                                                        & прим. \\ \hline\hline
        \NumberLo{000,101011}{111|.} & \Addition{000,000000000 000000000}  
                                                {111,000111111 .........}
                                                {111,000111111 000000000} & $-M$; сдвиг(3);\\ \hline
        \NumberLo{...,000101}{011|1} & \Addition{111,111000111 111000000}  
                                                {011,1000001.. .........}
                                                {011,011001011 111000000} & $+4M$; сдвиг(3);\\ \hline
        \NumberLo{...,...000}{101|0} & \Addition{...,011011001 011111000}  
                                                {101,010111101 .........}
                                                {101,110010110 011111000} & $-3M$; сдвиг(3);\\ \hline
        \NumberLo{...,......}{000|1} & \Addition{111,101110010 110011111}  
                                                {000,111000001 .........}
                                                {000,100110011 110011111} & $+M$; Рез-т!\\ \hline
    \end{tabular}
\end{frame}

\begin{frame}
    \frametitle{Умножение II сп.}
    \framesubtitle{$(101011111)_2\cdot(111000001)_2=(100110011110011111)_2$, масштаб операндов $8^3=2^9$}
    
    \resizebox{!}{.7\height}{
        \begin{tabular}{c|r|l}
            \hline\hline
            мн-ль $\rightarrow$ 
                & \multicolumn{1}{|c|}{мн-е $\leftarrow$; СЧП}       
                & прим. \\ 
            \hline\hline
            \NumberLo{000,101011}{111|0}  
                & \Stack{
                      \Stack{
                          \Register{ $M$}{,000000000 111000001}}{
                          \Register{$3M$}{,000000010 101000011}}}{
                                \Addition{,000000000 000000000}
                                         {,111111111 000111111}
                                         {,111111111 000111111}}  
                & $-M$; сдвиг(3);\\ \hline
            \NumberLo{...,000101}{011|1}  
                & \Stack{
                      \Stack{
                          \Register{ $M$}{,000000111 000001...}}{
                          \Register{$3M$}{,000010101 000011...}}}{
                                \Addition{,111111111 000111111}
                                         {,000011100 0001.....}
                                         {,000011011 001011111}}  
                & $+4M$; сдвиг(3);\\ \hline
            \NumberLo{...,...000}{101|0}  
                & \Stack{
                      \Stack{
                          \Register{ $M$}{,000111000 001......}}{
                          \Register{$3M$}{,010101000 011......}}}{
                                \Addition{,000011011 001011111}
                                         {,101010111 101......}
                                         {,101110010 110011111}}  
                & $-3M$; сдвиг(3);\\ \hline
            \NumberLo{...,......}{000|1}  
                & \Stack{
                      \Stack{
                          \Register{ $M$}{,111000001 .........}}{
                          \Register{$3M$}{,101000011 .........}}}{
                                \Addition{,101110010 110011111}
                                         {,111000001 .........}
                                         {,100110011 110011111}}  
                & $+M$; Рез-т!\\ \hline
        \end{tabular}
    }
\end{frame}

\begin{frame}
    \frametitle{Умножение III сп.}
    \framesubtitle{$(101011111)_2\cdot(111000001)_2=(100110011110011111)_2$, масштаб операндов $8^3=2^9$}
    
    $3\cdot(111000001)_2=(1110000010)_2+(111000001)_2=\Number{10 101000011}$
    \begin{tabular}{c|r|l}
        \hline\hline
        мн-ль $\leftarrow$ 
            & \multicolumn{1}{|c|}{СЧП $\leftarrow$}       
            & прим. \\ 
        \hline\hline
        \NumberHi{000,1}{01011111} 
            & \Addition{,000000000 000000000}
                       {,......... 111000001}
                       {,000000000 111000001} 
            & $+M$; сдвиг(3);\\ \hline
        \NumberHi{101,0}{11111...} 
            & \Addition{,000000111 000001...}
                       {,111111101 010111101}
                       {,000000100 011000101} 
            & $-3M$; сдвиг(3);\\ \hline
        \NumberHi{011,1}{11......} 
            & \Addition{,000100011 000101...}
                       {,.......11 1000001..}
                       {,000100110 100101100} 
            & $+4M$; сдвиг(3);\\ \hline
        \NumberHi{111,.}{........} 
            & \Addition{,100110100 101100...}
                       {,111111111 000111111}
                       {,100110011 110011111} 
            & $-M$; Рез-т!\\ \hline
    \end{tabular}
\end{frame}

\begin{frame}
    \frametitle{Умножение IV сп.}
    \framesubtitle{$(101011111)_2\cdot(111000001)_2=(100110011110011111)_2$, масштаб операндов $8^3=2^9$}
    
    \resizebox{!}{.7\height}{
        \begin{tabular}{c|r|l}
            \hline\hline
            мн-ль $\leftarrow$ 
                & \multicolumn{1}{|c|}{мн-е $\rightarrow$; СЧП}
                & прим. \\ 
            \hline\hline
            \NumberHi{000,1}{01011111} 
                & \Stack{
                      \Stack{
                          \Register{ $M$}{...,111000001 .........}}{
                          \Register{$3M$}{010,101000011 .........}}}{
                              \Addition{,000000000 000000000}
                                       {,111000001 .........}
                                       {,111000001 000000000}}  
                & $+M$; сдвиг(3);\\ \hline
            \NumberHi{101,0}{11111...} 
                & \Stack{
                      \Stack{
                          \Register{ $M$}{...,...111000 001......}}{
                          \Register{$3M$}{...,010101000 011......}}}{
                              \Addition{,111000001 000000000}
                                       {,101010111 101......}
                                       {,100011000 101000000}}  
                & $-3M$; сдвиг(3);\\ \hline
            \NumberHi{011,1}{11......} 
                & \Stack{
                      \Stack{
                          \Register{ $M$}{...,......111 000001...}}{
                          \Register{$3M$}{...,...010101 000011...}}}{
                              \Addition{,100011000 101000000}
                                       {,....11100 0001.....}
                                       {,100110100 101100000}}  
                & $+4M$; сдвиг(3);\\ \hline
            \NumberHi{111,.}{........} 
                & \Stack{
                      \Stack{
                          \Register{ $M$}{...,......... 111000001}}{
                          \Register{$3M$}{...,......010 101000011}}}{
                              \Addition{,100110100 101100000}
                                       {,111111111 000111111}
                                       {,100110011 110011111}}  
                & $-M$; Рез-т!\\ \hline
        \end{tabular}
    }
\end{frame}


\appendix


\section{Задания на практику}


\subsection{Проходное}

\begin{frame}
    \frametitle{\TaskSimpleNumber}
    
    Какой масштаб результата результата должен получиться, если модули перемножаемых двоичных чисел имеют разрядность 7 и используется метод ускорения
    \begin{itemize}
        \item второго порядка;
        \item третьего порядка.
    \end{itemize}
\end{frame}

\begin{frame}
    \frametitle{\TaskSimpleNumber}

    Перемножить числа:

    \begin{enumerate}
        \item множитель --- $103$, множимое --- $81$ III-м способом с ускорением второго порядка; 
        \item множитель --- $231$, множимое --- $81$ IV-м способом с ускорением второго порядка.
        \item множитель --- $226$, множимое --- $161$ I-м  способом с ускорением третьего порядка; 
        \item множитель --- $495$, множимое --- $161$ II-м способом с ускорением третьего порядка; 
    \end{enumerate}
    
    Обосновать выбор масштаба.
\end{frame}

\subsection{Мегамозг}

\begin{frame}
    \frametitle{\TaskSimpleNumber}
    
    Разработать метод ускорения четвертого порядка.
\end{frame}

\section{Самообучение}

\begin{frame}
    \frametitle{Советы самоучке}
    
    Классика жанра: \cite{bib:lisikov:automateBase}.
\end{frame}

\begin{frame}[allowframebreaks]{Библиография}
    \bibliographystyle{gost780u}
    \bibliography{./../../../bibliobase}
\end{frame}

\end{document}