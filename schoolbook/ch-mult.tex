\chapter{Умножение двоичных чисел}
\label{ch:binmul}

Пусть для положительных чисел $A$ и $B$ имеются дробно-масштабированные представления в двоичной системе счисления. Пусть
\[
    A\equiv(0,a_{1}\cdots a_{n})_2.
\]

Тогда результат произведения дробных $A\times B$ будет определяться по формуле:
\[
    A\times B = B\cdot\sum_{i=1}^{n} a_{i}\cdot 2^{-i} = \sum_{i=1}^{n} (B\cdot 2^{-i})\cdot a_i = \sum_{i=1}^{n} (B \gg i)\cdot a_i.
\]

Результат произведения --- сумма, в которой $i$-е слагаемое есть двоичное представление множимого $B$, сдвинутое на $i$ разрядов вправо\footnote{Сдвиг вправо множимого $B$ здесь обозначен как $(B \gg i)$. Напомним, что умножение на $2$ в двоичной системе счисления эквивалентно сдвигу на один разряд влево (или, что то же самое, переносу запятой на один разряд вправо). Делению на $2$ соответствует сдвиг на один разряд вправо или перенос запятой на разряд влево.}. Причем $i$-е слагаемое входит в сумму только когда $a_i=1$.

Например, требуется найти произведение $A\times B$, где $A=23$ и $B=25$. Дробные представления (с масштабирующим множителем $M=2^5$) будут:
\begin{align*}
    A\equiv\Number{,10111},\\
    B\equiv\Number{,11001}.
\end{align*}

Процесс умножения\footnote{Здесь и в последующих примерах вместо точки в представлении числа можно ставить нуль. Таким образом авторы постарались повысить наглядность. Целая часть числа от дробной части будет отделяться запятой.}:
\begin{center}
    \begin{tabular}{c|c|c}
                                                                   \hline\hline
        $i$ & Разряды $a_i$    & $(B\cdot 2^{-i}) \cdot a_i$  \\ \hline\hline
        1   & \Number{,1....} & \Number{,.1100 1....} \\
        2   & \Number{,.0...} & \Number{,..... .....} \\
        3   & \Number{,..1..} & \Number{,...11 001..} \\
        4   & \Number{,...1.} & \Number{,....1 1001.} \\
        5   & \Number{,....1} & \Number{,..... 11001} \\ \hline
        \multicolumn{2}{r}{Результат:} 
                               & \Number{0,10001 11111} \\
    \end{tabular}
\end{center}

Сумму сдвигов множимого, полученную на некотором шаге алогритма умножения, будем назвать \emph{суммой частичных произведений} (СЧП).

В схемной реализации АЛУ для умножения удобно использовать сдвиговые регистры. При этом разработчику решать:
\begin{itemize}
    \item в какую сторону сдвигать регистр множителя (или, что то же самое: какой разряд множителя, старший или младший, анализировать);
    \item сдвигать множимое или вместо этого сдвигать накопленную сумму частичных произведений.
\end{itemize}

Ответы на эти вопросы рождают четыре основных способа\footnote{Можно сказать, что и четыре основные аппаратные схемы} умножения, представленных на рисунке \ref{fig:binmul:baseschemes}.
\begin{figure}[!ht]
    \begin{tabular}{c||c||c}
            & Сдвиг СЧП
                & Сдвиг множимого\\
        \hline\hline
        \rotatebox{90}{Сдвиг мн-ля вправо}
            & \includegraphics[width=.45\textwidth]{fig/mult-methods.1}
                & \includegraphics[width=.45\textwidth]{fig/mult-methods.2}\\
        \hline\hline
        \rotatebox{90}{Сдвиг мн-ля влево}
            & \includegraphics[width=.45\textwidth]{fig/mult-methods.3}
                & \includegraphics[width=.45\textwidth]{fig/mult-methods.4}\\
    \end{tabular}
    \caption{Основные схемы методов умножения на сдвиговых регистрах}\label{fig:binmul:baseschemes}
\end{figure}

Кратко опишем способы и их особенности.
\begin{itemize}
    \item I-й способ. Анализ младшего разряда множителя со сдвигом СЧП вправо. Множимое прибавляется к старшей половине СЧП (см. рисунок \ref{fig:binmul:baseschemes}). В процессе умножения может возникнуть единица переноса из старшего (на рисунке 1-го) разрядя регистра СЧП. Эта единица не должна быть потеряна. При очередном сдвиге СЧП вправо она должна заноситься в старший разряд СЧП. Также обязательно выполняется сдвиг СЧП на последнем шаге основного цикла умножения.
        
    \item II-й способ. Анализ младшего разляда множителя со сдвигом множимого влево. Множимое заносится в младшие $n$ разрядов соответствующего $2n$ разрядного регистра. 
    
    \item III-й способ. Анализ старшего разряда множителя со сдвигом СЧП влево. Множимое прибавляется к младшим $n$ разрядам СЧП, а к старшим прибавляется нули. На последнем шаге умножения сдвиг СЧП не выполняется.
    
    \item IV-й способ. Анализ старшего разляда множителя со сдвигом множимого влево. Множимое заносится в младшие $n$ разрядов соответствующего $2n$ разрядного регистра. На первом шаге до анализа старшего разряда множителя выполняется сдвиг множимого на один разряд влево.
\end{itemize}

Суммарную разрядность регистров и сумматоров нетрудно посчитать:
\begin{itemize}
    \item I-й способ: регистров --- $4n$, сумматор --- $n$;
    \item II-й способ: регистров --- $5n$, сумматор --- $2n$;
    \item III-й способ: регистров --- $4n$, сумматор --- $2n$;
    \item IV-й способ: регистров --- $5n$, сумматор --- $2n$.
\end{itemize}

Отдельно стоит отметить экономичность I-го способа умножения, который позволяет сократить суммарную разрядность регистров до $3n$ при одном $n$-разрядном сумматоре. При этом младшие биты регистра СЧП заносятся в старшие разряды регистра множителя при их одновременном сдвиге. Старшие $n$ бит результата при этом получаются в регистре СЧП, а младшие в регистре множителя (рис. \ref{fig:binmul:Ioptimized}).
\begin{figure}[!ht]
    \centering
    \includegraphics{fig/mult-methods.5}
    \caption{Первый способ умножения (экономная версия)}\label{fig:binmul:Ioptimized}
\end{figure}


\section{Целочисленное умножение}
\label{ch::div}

Далее рассматриваются основные алгоритмы умножения беззнаковых целых чисел и целых чисел со знаком (в дополнительном коде). Следует отметить, что для удобства рассуждений используется \emph{дробное} масштабирование с масштабом $M=2^n$, где $n$ --- разрядность. 

\input{ch-mult-sct-pc}
\input{ch-mult-sct-fast}
\input{ch-mult-sct-dcmanual}
\input{ch-mult-sct-dcauto}

\input{ch-mult-sct-float}

